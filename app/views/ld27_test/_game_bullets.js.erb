var GameBullets={
  bullets_to_sync:[],
  /**
   * List of IDs to compare against before creating new bullet.
   */
  bullets_seen:[],
  bullets:[],
  addBulletFromJSON:function(json)
  {
    var bullet = {
      faction: 'evil',
      damage: 30,
      type: 'basic',
      x: json['x'],
      y: json['y'],
      xOffset: 0,
      yOffset: -10, //ugly constants
      rot: json['rot'],
      velocityX: json['velocityX'],
      velocityY: json['velocityY'],
      color: "255,255,255",
      alpha: 1,
      decay: 0.98,
      falloff: 0.2,
      size: 10
    }
    console.log("ONE IN THE CHAMBER")
    console.log(bullet)
    this.bullets.push(bullet)
    console.log("COUNT: "+this.bullets.length)
    //do stuff
  },
  addBullet:function(ship, type)
  {
    var bulletRotation = ship.rot + (((Math.random()*type.spread)-(type.spread/2))/180*Math.PI)
    //TODO: Accept bullet type etc.
    var bullet = {
      faction: ship.faction,
      damage: type.damage, 
      type: type.name,
      x: ship.x,
      y: ship.y,
      xOffset: 0,
      yOffset: -ship.height/2,
      rot: bulletRotation,
      velocityX: type.velocity * Math.sin(bulletRotation) + ship.velocityX, 
      velocityY: type.velocity * -Math.cos(bulletRotation) + ship.velocityY,
      color: ship.color,
      alpha: 1,
      decay: type.decay,
      falloff: type.falloff,
      size: 10
    }

    this.bullets.push(bullet)
    this.bullets_to_sync.push(bullet)
  },
  render:function(ctx)
  {
    GameView.renderModeGame();
    var i = this.bullets.length
    while (i--) {
      bullet = this.bullets[i];
      ctx.fillStyle = "rgba("+bullet.color+","+bullet.alpha+")"
      ctx.translate(bullet.x, bullet.y);
      ctx.rotate(bullet.rot);
      ctx.fillRect(
        bullet.xOffset-0.5,
        bullet.yOffset-0.5,
        2,
        bullet.size
      )
      ctx.rotate(-bullet.rot);
      ctx.translate(-bullet.x, -bullet.y);
    }
  },
  logic:function()
  {
    var i = this.bullets.length
    while (i--) {
      bullet = this.bullets[i]
      bullet.alpha = bullet.alpha * bullet.decay
      bullet.x = bullet.x + bullet.velocityX//*Math.sin(bullet.rot);
      bullet.y = bullet.y + bullet.velocityY//*-Math.cos(bullet.rot);      
      if(bullet.alpha <= bullet.falloff)
      {
        this.bullets.splice(i, 1);
      } 
      else if(bullet.HP <= 0)
      {
        this.bullets.splice(i, 1);
      }
    }
  }
}